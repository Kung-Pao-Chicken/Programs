<p>新开一个博客，把以前学习的笔记整理整理，防止忘记</p><p><span style="color:#FF6600">1.变量定义：</span></p><div class="dp-highlighter bg_vb"><div class="bar"><div class="tools"><strong>[vb]</strong> <a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="ViewSource" title="view plain">view plain</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="CopyToClipboard" title="copy">copy</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="PrintSource" title="print">print</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="About" title="?">?</a></div></div><ol class="dp-vb" start="1"><li class="alt"><span><span class="keyword">Dim</span><span>&nbsp;sender1&nbsp;</span><span class="keyword">As</span><span>&nbsp;</span><span class="keyword">New</span><span>&nbsp;System.Net.Sockets.Socket(Net.Sockets.AddressFamily.InterNetwork,&nbsp;Net.Sockets.SocketType.Stream,&nbsp;Net.Sockets.ProtocolType.Tcp)&nbsp;</span><span class="comment">&#39;用来处理发送和接收消息的Socket实例</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span><span class="keyword">Dim</span><span>&nbsp;bytes(1024)&nbsp;</span><span class="keyword">As</span><span>&nbsp;</span><span class="keyword">Byte</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span><span class="keyword">Dim</span><span>&nbsp;msg&nbsp;</span><span class="keyword">As</span><span>&nbsp;</span><span class="keyword">Byte</span><span>()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment">&#39;发送的消息</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span><span class="keyword">Dim</span><span>&nbsp;bytesRec&nbsp;</span><span class="keyword">As</span><span>&nbsp;</span><span class="keyword">Integer</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment">&#39;接收到的数据的长度</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span><span class="keyword">Dim</span><span>&nbsp;sbytes(1024)&nbsp;</span><span class="keyword">As</span><span>&nbsp;</span><span class="keyword">Byte</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment">&#39;接收到的数据流</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span><span class="keyword">Dim</span><span>&nbsp;data&nbsp;</span><span class="keyword">As</span><span>&nbsp;</span><span class="keyword">String</span><span>&nbsp;=&nbsp;</span><span class="keyword">Nothing</span><span>&nbsp;</span><span class="comment">&#39;处理后的接收到的消息</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span><span class="keyword">Dim</span><span>&nbsp;t&nbsp;</span><span class="keyword">As</span><span>&nbsp;System.Threading.Thread&nbsp;&nbsp;</span></span></li></ol></div><p><span style="color:#FF6600">2.请求连接服务端：</span></p><div class="dp-highlighter bg_vb"><div class="bar"><div class="tools"><strong>[vb]</strong> <a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="ViewSource" title="view plain">view plain</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="CopyToClipboard" title="copy">copy</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="PrintSource" title="print">print</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="About" title="?">?</a></div></div><ol class="dp-vb" start="1"><li class="alt"><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment">&#39;启动请求连接</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Control.CheckForIllegalCrossThreadCalls&nbsp;=&nbsp;<span class="keyword">False</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;<span class="keyword">New</span><span>&nbsp;Thread(</span><span class="keyword">AddressOf</span><span>&nbsp;waitdata)&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Start()&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">&#39;设置并连接服务端IP地址</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">Public</span><span>&nbsp;</span><span class="keyword">Sub</span><span>&nbsp;waitdata()&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">On</span><span>&nbsp;</span><span class="keyword">Error</span><span>&nbsp;</span><span class="keyword">GoTo</span><span>&nbsp;wrong&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;=&nbsp;InputBox(<span class="string">&quot;Please&nbsp;input&nbsp;the&nbsp;IP&nbsp;address&quot;</span><span>)&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">Dim</span><span>&nbsp;handler&nbsp;</span><span class="keyword">As</span><span>&nbsp;</span><span class="keyword">New</span><span>&nbsp;System.Net.IPEndPoint(Net.IPAddress.Parse(bool),&nbsp;9990)&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">Me</span><span>.Text&nbsp;=&nbsp;</span><span class="string">&quot;Connect&nbsp;to&nbsp;the&nbsp;Server...&quot;</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">Dim</span><span>&nbsp;localEndPoint&nbsp;</span><span class="keyword">As</span><span>&nbsp;</span><span class="keyword">New</span><span>&nbsp;System.Net.IPEndPoint(Net.IPAddress.Parse(bool),&nbsp;9990)&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sender1.Connect(handler)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">Me</span><span>.Text&nbsp;=&nbsp;</span><span class="string">&quot;Connect&nbsp;to&nbsp;the&nbsp;server&nbsp;Successfully!&quot;</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Button3.Text&nbsp;=&nbsp;<span class="string">&quot;已连接&quot;</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">Dim</span><span>&nbsp;p&nbsp;</span><span class="keyword">As</span><span>&nbsp;System.Threading.Thread&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;<span class="keyword">New</span><span>&nbsp;Thread(</span><span class="keyword">AddressOf</span><span>&nbsp;resdata)&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.Start()&nbsp;&nbsp;</span></li><li class=""><span>wrong:&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">End</span><span>&nbsp;</span><span class="keyword">Sub</span><span>&nbsp;&nbsp;</span></span></li></ol></div><p><span style="color:#FF6600">3.接收消息并处理：</span></p><div class="dp-highlighter bg_vb"><div class="bar"><div class="tools"><strong>[vb]</strong> <a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="ViewSource" title="view plain">view plain</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="CopyToClipboard" title="copy">copy</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="PrintSource" title="print">print</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="About" title="?">?</a></div></div><ol class="dp-vb" start="1"><li class="alt"><span><span class="keyword">Public</span><span>&nbsp;</span><span class="keyword">Sub</span><span>&nbsp;resdata()&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">On</span><span>&nbsp;</span><span class="keyword">Error</span><span>&nbsp;</span><span class="keyword">GoTo</span><span>&nbsp;wrong&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">While</span><span>&nbsp;(</span><span class="keyword">True</span><span>)&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bytes&nbsp;=&nbsp;<span class="keyword">New</span><span>&nbsp;</span><span class="keyword">Byte</span><span>(1024)&nbsp;{}&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bytesRec&nbsp;=&nbsp;sender1.Receive(bytes)&nbsp;<span class="comment">&#39;接收数据&nbsp;</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">If</span><span>&nbsp;bytesRec&nbsp;&gt;&nbsp;0&nbsp;</span><span class="keyword">Then</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;System.Text.Encoding.<span class="keyword">Unicode</span><span>.GetString(bytes,&nbsp;0,&nbsp;bytesRec)&nbsp;</span><span class="comment">&#39;字节消息流转码为&nbsp;String</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RichTextBox1.AppendText(data)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">Else</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Continue&nbsp;<span class="keyword">While</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">End</span><span>&nbsp;</span><span class="keyword">If</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">End</span><span>&nbsp;</span><span class="keyword">While</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">Exit</span><span>&nbsp;</span><span class="keyword">Sub</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>g:&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;sender1.Shutdown(Net.Sockets.SocketShutdown.Both)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;sender1.Close()&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox(<span class="string">&quot;连接断开！&quot;</span><span>)&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">Me</span><span>.Text&nbsp;=&nbsp;</span><span class="string">&quot;失去连接&quot;</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span><span class="keyword">End</span><span>&nbsp;</span><span class="keyword">Sub</span><span>&nbsp;&nbsp;</span></span></li></ol></div><span style="color:#FF6600">4.发送消息</span><div class="dp-highlighter bg_vb"><div class="bar"><div class="tools"><strong>[vb]</strong> <a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="ViewSource" title="view plain">view plain</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="CopyToClipboard" title="copy">copy</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="PrintSource" title="print">print</a><a href="http://blog.csdn.net/rapheal_jy/article/details/39553317#" class="About" title="?">?</a></div></div><ol class="dp-vb" start="1"><li class="alt"><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">Private</span><span>&nbsp;</span><span class="keyword">Sub</span><span>&nbsp;Button1_Click(</span><span class="keyword">ByVal</span><span>&nbsp;sender&nbsp;</span><span class="keyword">As</span><span>&nbsp;System.</span><span class="keyword">Object</span><span>,&nbsp;</span><span class="keyword">ByVal</span><span>&nbsp;e&nbsp;</span><span class="keyword">As</span><span>&nbsp;System.EventArgs)&nbsp;</span><span class="keyword">Handles</span><span>&nbsp;Button1.Click&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">On</span><span>&nbsp;</span><span class="keyword">Error</span><span>&nbsp;</span><span class="keyword">GoTo</span><span>&nbsp;wrong&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg&nbsp;=&nbsp;System.Text.Encoding.<span class="keyword">Unicode</span><span>.GetBytes(RichTextBox2.Text)&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sender1.Send(msg)&nbsp;&nbsp;&nbsp;<span class="comment">&#39;发送消息</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RichTextBox2.Text&nbsp;=&nbsp;<span class="string">&quot;&quot;</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">Exit</span><span>&nbsp;</span><span class="keyword">Sub</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>wrong:&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox(<span class="string">&quot;连接断开！&quot;</span><span>)&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">End</span><span>&nbsp;</span><span class="keyword">Sub</span><span>&nbsp;&nbsp;</span></span></li></ol></div><span style="color:#FF0000">Client端和Server端的区别并不是很大，主要有服务端首先开启监听端口并且轮询监听是否有连接进来，之后由客户端请求连接端口；服务端收到连接后，同意连接，连接成立，双方建立一个新的Socket来进行消息传输。</span>