<div class="markdown_views"><p>条件：路由器需要支持upnp功能，并且要处于打开状态。</p><p><span style="color:#ff0000"><strong>0x01 引用</strong></span></p><pre name="code" class="prettyprint">using NATUPNPLib;                //Windows UPnP COM组件1</pre><p><strong><span style="color:#FF0000">0x02 功能</span></strong></p><p name="code" class="prettyprint"><code class="hljs cs has-numbering"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-keyword">private</span> Boolean <span class="hljs-title">OpenUPnp</span>(){</code></p><p name="code" class="prettyprint"><code class="hljs cs has-numbering"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; IStaticPortMappingCollection mappings = _uPnPNAT.StaticPortMappingCollection;</code></p><p name="code" class="prettyprint"><code class="hljs cs has-numbering"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="hljs-keyword">if</span> (mappings == <span class="hljs-keyword">null</span>){</code></p><p name="code" class="prettyprint"><code class="hljs cs has-numbering">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(<span class="hljs-string">&quot;没有检测到路由器，或者路由器不支持UPnP功能&quot;</span>);</code></p><p name="code" class="prettyprint"><code class="hljs cs has-numbering">&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</code></p><p name="code" class="prettyprint"><code class="hljs cs has-numbering">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</code></p><p name="code" class="prettyprint"><code class="hljs cs has-numbering">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mappings.Add([<span class="hljs-keyword">int</span>外部端口], <span class="hljs-string">&quot;TCP&quot;</span>, [<span class="hljs-keyword">int</span>内部端口], [<span class="hljs-keyword">string</span>内网ip], <span class="hljs-keyword">true</span>, description);</code></p><p name="code" class="prettyprint"><code class="hljs cs has-numbering"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</code></p><p name="code" class="prettyprint"><code class="hljs cs has-numbering">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</code></p><p>之后只需要端口和外网ip就可以进行socket连接了。<span style="color:#FF0000">有些家用网络包含两层NAT或更多，这种方法便不可行</span>。</p></div>